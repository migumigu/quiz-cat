<!DOCTYPE html>
<html>
<head>
    <title>{{ course.grade }}{{ course.subject }}{{ course.term }} - æ¸¸æˆå…³å¡</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/game.css') }}">
    <style>
        /* é©¬è’‚æ–¯é…è‰²æ–¹æ¡ˆ */
        :root {
            --matisse-bg: #F5F5DC; /* ç±³è‰²èƒŒæ™¯ */
            --matisse-primary: #FF6B6B; /* çŠç‘šçº¢ */
            --matisse-secondary: #4ECDC4; /* ç»¿æ¾çŸ³ */
            --matisse-accent: #FFE66D; /* æ˜é»„ */
            --matisse-dark: #292F36; /* æ·±ç°è“ */
            --matisse-text: #292F36; /* æ·±ç°è“æ–‡å­— */
            --matisse-light: #FFFFFF; /* ç™½è‰² */
        }

        body {
            background-color: var(--matisse-bg);
            color: var(--matisse-text);
        }

        .course-title {
            color: var(--matisse-primary);
        }

        .unit-title {
            color: var(--matisse-secondary);
        }

        .level-card {
            background: var(--matisse-light);
            border-color: var(--matisse-dark);
        }

        .level-card.completed {
            background: var(--matisse-secondary);
            color: var(--matisse-light);
        }

        /* æ™®é€šUNLOCKEDå…³å¡ */
        .level-card.unlocked:not(.is_midterm):not(.is_final) {
            background: var(--matisse-accent) !important;
        }
        .level-card.unlocked:not(.is_midterm):not(.is_final) .card-status {
            color: var(--matisse-dark) !important;
            font-weight: bold !important;
        }

        /* æœŸä¸­/æœŸæœ«UNLOCKEDå…³å¡ä¿æŒæ·±è‰²èƒŒæ™¯ */
        .level-card.unlocked.is_midterm,
        .level-card.unlocked.is_final {
            background: var(--matisse-dark) !important;
        }
        .level-card.unlocked.is_midterm .card-status,
        .level-card.unlocked.is_final .card-status {
            color: var(--matisse-accent) !important;
        }

        .boss-card {
            background: var(--matisse-primary) !important; /* çŠç‘šçº¢èƒŒæ™¯ */
            color: var(--matisse-light) !important; /* ç™½è‰²æ–‡å­— */
        }

        /* æœŸä¸­æ£€æµ‹å…³å¡ */
        .level-card.is_midterm {
            background: var(--matisse-dark) !important; /* æ¢å¤æ·±ç°è“èƒŒæ™¯ */
        }
        .level-card.is_midterm h3,
        .level-card.is_midterm .card-desc {
            color: var(--matisse-light) !important; /* ç™½è‰²æ ‡é¢˜å’Œæè¿° */
        }

        /* æœŸæœ«è€ƒæ ¸å…³å¡ */
        .level-card.is_final {
            background: var(--matisse-dark) !important; /* æ¢å¤æ·±ç°è“èƒŒæ™¯ */
        }
        .level-card.is_final h3,
        .level-card.is_final .card-desc {
            color: var(--matisse-light) !important; /* ç™½è‰²æ ‡é¢˜å’Œæè¿° */
        }

        /* çŠ¶æ€æ–‡å­—ä¿æŒæ˜é»„è‰² */
        .level-card .card-status {
            color: var(--matisse-accent) !important;
        }
    </style>
    <style>
        /* é©¬è’‚æ–¯é…è‰²æ–¹æ¡ˆ */
        :root {
            --matisse-bg: #F5F5DC; /* ç±³è‰²èƒŒæ™¯ */
            --matisse-primary: #FF6B6B; /* çŠç‘šçº¢ */
            --matisse-secondary: #4ECDC4; /* ç»¿æ¾çŸ³ */
            --matisse-accent: #FFE66D; /* æ˜é»„ */
            --matisse-dark: #292F36; /* æ·±ç°è“ */
            --matisse-text: #292F36; /* æ·±ç°è“æ–‡å­— */
            --matisse-light: #FFFFFF; /* ç™½è‰² */
        }

        body {
            background-color: var(--matisse-bg);
            color: var(--matisse-text);
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            padding: 20px;
        }
        
        .game-cards-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 0 20px; /* æ·»åŠ å·¦å³å†…è¾¹è· */
            box-sizing: border-box; /* ç¡®ä¿å†…è¾¹è·ä¸å½±å“æ€»å®½åº¦ */
        }
        
        .course-title {
            color: var(--matisse-primary);
            text-align: center;
            margin-bottom: 1rem;
            text-shadow: 2px 2px 0 var(--matisse-dark);
        }
        
        .progress-container {
            text-align: center;
            margin-bottom: 2rem;
            font-weight: bold;
            color: var(--matisse-text);
        }
        
        .unit-title {
            color: var(--matisse-secondary);
            margin: 2rem 0 1rem;
            padding-left: 10px;
            border-left: 5px solid var(--matisse-primary);
        }
        
        .cards-flow {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 2rem;
            width: 100%;
        }
        
        .level-card {
            width: calc(100% - 40px); /* å‡å»å®¹å™¨çš„å†…è¾¹è· */
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            box-sizing: border-box; /* ç¡®ä¿å†…è¾¹è·ä¸å½±å“æ€»å®½åº¦ */
            background: var(--matisse-light);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid var(--matisse-dark);
            box-shadow: 3px 3px 0 var(--matisse-dark);
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .level-card:hover {
            transform: translate(-2px, -2px);
            box-shadow: 5px 5px 0 var(--matisse-dark);
        }
        
        .level-card.completed {
            background: var(--matisse-secondary);
            color: var(--matisse-light);
        }
        
        .level-card.unlocked {
            background: var(--matisse-accent);
        }
        
        .level-card.locked {
            opacity: 0.7;
        }
        
        .boss-card {
            background: var(--matisse-primary) !important;
            color: var(--matisse-light) !important;
        }
        
        .special-card {
            background: var(--matisse-dark) !important;
            color: var(--matisse-accent) !important;
        }
        
        .card-icon {
            font-size: 2rem;
            text-align: center;
            margin-bottom: 10px;
        }
        
        .card-content h3 {
            margin: 0 0 5px 0;
            font-size: 1.1rem;
        }
        
        .card-desc, .card-status {
            margin: 0;
            font-size: 0.9rem;
        }
        
        @media (max-width: 600px) {
            .cards-flow {
                justify-content: center;
            }
            
            .level-card {
                width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="game-cards-container">
        <h2 class="course-title">{{ course.grade }}{{ course.subject }}{{ course.term }}</h2>
        <div class="progress-container">
            è¿›åº¦: {{ ((progress.values()|select('equalto','completed')|list|length) / progress.values()|length * 100)|round }}%
        </div>
        
        {% for unit in units %}
        <h3 class="unit-title">{{ unit.name }}</h3>
        <div class="cards-flow">
            {% for level in unit.levels %}
            <div class="level-card {{ progress[level.id] }} 
                    {{ 'boss-card' if level.is_boss else 'is_midterm' if level.is_midterm else 'is_final' if level.is_final else '' }}"
                data-level-id="{{ level.id }}">
                <div class="card-icon">
                    {% if progress[level.id] == 'completed' %}âœ“
                    {% elif progress[level.id] == 'unlocked' %}â—
                    {% elif level.is_boss %}ğŸ°
                    {% elif level.is_midterm %}ğŸ”„
                    {% elif level.is_final %}ğŸ¯
                    {% else %}{{ loop.index }}{% endif %}
                </div>
                <div class="card-content">
                    <h3>{{ level.title }}</h3>
                    <p class="card-desc">
                        {% if level.is_boss %}ç»ˆææŒ‘æˆ˜
                        {% elif level.is_midterm %}æœŸä¸­æ£€æµ‹
                        {% elif level.is_final %}æœŸæœ«è€ƒæ ¸
                        {% elif level.content_ref %}{{ level.content_ref }}
                        {% else %}ç¬¬ {{ level.order }} å…³{% endif %}
                    </p>
                    <p class="card-status">
                        {{ progress[level.id]|upper }}
                    </p>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
    </div>

    <script>
        // ä¿®å¤JavaScripté”™è¯¯
        document.addEventListener('DOMContentLoaded', function() {
            // ç¡®ä¿å…ƒç´ å­˜åœ¨å†æ“ä½œ
            const levelCards = document.querySelectorAll('.level-card');
            if (levelCards) {
                levelCards.forEach(card => {
                    card.addEventListener('click', function() {
                        const levelId = this.getAttribute('data-level-id');
                        if (this.classList.contains('unlocked') || this.classList.contains('completed')) {
                            window.location.href = `/quiz/${levelId}`;
                        }
                    });
                });
            }
        });
    </script>
</body>
</html>